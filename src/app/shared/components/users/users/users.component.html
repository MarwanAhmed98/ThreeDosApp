<div class="animate-in fade-in duration-500">
  <!-- Header Section -->
  <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-6">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold tracking-tight text-main">
        User Management
      </h1>
      <p class="text-muted mt-2 text-sm md:text-base">
        Manage access, roles, and permissions for your team members.
      </p>
    </div>
    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
      <button
        class="flex items-center justify-center gap-2 px-4 py-2.5 bg-surface border border-main rounded-xl font-semibold hover:bg-brand-purple/5 text-main transition-all shadow-sm active:scale-95">
        <i class="fas fa-file-import text-muted"></i>
        <span class="text-sm">Bulk Import</span>
      </button>
      <button (click)="openAddModal()"
        class="flex items-center justify-center gap-2 px-6 py-2.5 bg-brand-purple text-white rounded-xl font-semibold hover:bg-opacity-90 transition-all shadow-md shadow-brand-purple/20 active:scale-95">
        <i class="fas fa-plus"></i>
        <span class="text-sm">Create User</span>
      </button>
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="flex flex-col xl:flex-row items-stretch xl:items-center gap-4 mb-6">
    <!-- Search -->
    <div class="relative flex-1">
      <span class="absolute inset-y-0 left-0 pl-3.5 flex items-center text-muted">
        <i class="fas fa-search"></i>
      </span>
      <input [(ngModel)]="text" type="text" placeholder="Search by Name, Email..."
        class="w-full pl-11 pr-4 py-2.5 bg-surface border border-main rounded-xl focus:outline-none focus:ring-4 focus:ring-brand-purple/10 focus:border-brand-purple transition-all shadow-sm text-sm text-main placeholder-muted" />
    </div>

    <!-- Filter Selects -->
    <div class="grid grid-cols-2 md:flex md:items-center gap-2 lg:gap-3">
      <select
        class="bg-surface border border-main rounded-xl px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-brand-purple/20 shadow-sm cursor-pointer text-main">
        <option>Role: All</option>
      </select>
      <select
        class="bg-surface border border-main rounded-xl px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-brand-purple/20 shadow-sm cursor-pointer text-main">
        <option>Council: All</option>
      </select>
      <select
        class="bg-surface border border-main rounded-xl px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-brand-purple/20 shadow-sm font-medium cursor-pointer text-main">
        <option>Status: Active</option>
      </select>
      <button
        class="p-2.5 bg-surface border border-main rounded-xl hover:bg-brand-purple/5 shadow-sm transition-colors hidden md:block text-muted">
        <i class="fas fa-filter"></i>
      </button>
    </div>
  </div>

  <!-- Table Content -->
  <div class="bg-surface border border-main rounded-2xl overflow-hidden shadow-sm">
    <!-- Desktop View: Table -->
    <div class="hidden md:block overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead class="bg-app border-b border-main">
          <tr>
            <th class="px-6 py-4 w-10">
              <input type="checkbox" class="rounded border-main bg-app text-brand-purple focus:ring-brand-purple" />
            </th>
            <th class="px-6 py-4 text-xs font-bold text-muted uppercase tracking-wider">
              User
            </th>
            <th class="px-6 py-4 text-xs font-bold text-muted uppercase tracking-wider text-center">
              Role
            </th>
            <th class="px-6 py-4 text-xs font-bold text-muted uppercase tracking-wider text-center">
              Council
            </th>
            <th class="px-6 py-4 text-xs font-bold text-muted uppercase tracking-wider text-center">
              Last Active
            </th>
            <th class="px-6 py-4 text-xs font-bold text-muted uppercase tracking-wider text-center">
              Status
            </th>
            <th class="px-6 py-4 text-xs font-bold text-muted uppercase tracking-wider text-center">
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="divide-y border-main">
          @for (User of UsersList | searchuser: text; track User.id) {
          <tr class="hover:bg-brand-purple/5 transition-colors">
            <td class="px-6 py-4">
              <input type="checkbox" class="rounded border-main bg-app text-brand-purple focus:ring-brand-purple" />
            </td>
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <img src="https://ui-avatars.com/api/?name={{
                      User.name
                    }}&background=7F4797&color=ffffff"
                  class="w-10 h-10 rounded-full object-cover ring-2 ring-surface shadow-sm shrink-0" alt="avatar" />
                <div>
                  <div class="font-semibold text-main leading-none">
                    {{ User.name }}
                  </div>
                  <div class="text-xs text-muted mt-1">
                    {{ User.email }}
                  </div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 text-center">
              <span class="px-2.5 py-1 rounded-full text-[11px] font-bold uppercase tracking-wider" [ngClass]="{
                    'bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300':
                      User.role === 'Head',
                    'bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300':
                      User.role == 'Instructor',
                  }">{{ User.role }}</span>
            </td>
            <td class="px-6 py-4 text-center">
              <span
                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border border-main bg-surface shadow-sm text-main">
                <span class="w-1.5 h-1.5 rounded-full" [ngClass]="{
                      'bg-blue-500':
                        User.council === 'Backend Development Council',
                      'bg-orange-500':
                        User.council === 'Frontend Development Council',
                      'bg-pink-500': User.council === 'Marketing',
                      'bg-indigo-500': User.council === 'Engineering',
                    }"></span>
                {{ User.council }}
              </span>
            </td>
            <td class="px-6 py-4 text-center text-sm text-muted font-medium">
              {{ User.last_active }}
            </td>
            <td class="px-6 py-4 text-center">
              <span
                class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[11px] font-bold uppercase tracking-wider"
                [ngClass]="{
                    'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300':
                      User.status === 'Active',
                    'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400':
                      User.status === 'Offline',
                    'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300':
                      User.status === 'Invited',
                  }">
                {{ User.status }}
              </span>
            </td>
            <td class="px-6 py-4">
              <div class="flex justify-center gap-2">
                <button (click)="openEditModal(User)"
                  class="p-1.5 text-brand-purple hover:bg-brand-purple/10 rounded-lg transition-colors">
                  <i class="fas fa-edit"></i>
                </button>
                @if (
                User.role !== "VicePresident" &&
                User.role !== "Head" &&
                User.role !== "Instructor"
                ) {
                <button (click)="deleteUser(User.id)"
                  class="p-1.5 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors">
                  <i class="fas fa-trash"></i>
                </button>
                }
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Mobile View: Card List -->
    <div class="md:hidden divide-y border-main">
      @for (User of UsersList | searchuser: text; track User.id) {
      <div class="p-4 flex flex-col gap-4">
        <div class="flex items-start justify-between">
          <div class="flex items-center gap-3">
            <img src="https://ui-avatars.com/api/?name={{
                  User.name
                }}&background=7F4797&color=ffffff" class="w-12 h-12 rounded-full ring-2 ring-main" alt="avatar" />
            <div>
              <div class="font-bold text-main">{{ User.name }}</div>
              <div class="text-xs text-muted">{{ User.email }}</div>
            </div>
          </div>
          @if (
          User.role !== "VicePresident" &&
          User.role !== "Head" &&
          User.role !== "Instructor"
          ) {
          <button (click)="deleteUser(User.id)" class="text-red-400 p-1 hover:text-red-600">
            <i class="fas fa-trash"></i>
          </button>
          }
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="bg-app p-2 rounded-lg border border-main">
            <span class="block text-[10px] uppercase font-bold text-muted mb-1">Role</span>
            <span class="text-xs font-semibold text-main">{{
              User.role
              }}</span>
          </div>
          <div class="bg-app p-2 rounded-lg border border-main">
            <span class="block text-[10px] uppercase font-bold text-muted mb-1">Status</span>
            <span class="text-xs font-semibold text-emerald-500">{{
              User.status
              }}</span>
          </div>
        </div>

        <div class="flex items-center justify-between text-xs text-muted">
          <span class="flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-brand-purple"></span>
            {{ User.council }}
          </span>
          <span class="italic">Last seen: {{ User.last_active }}</span>
        </div>
      </div>
      }
    </div>

    <!-- Pagination -->
    <div class="px-6 py-4 bg-app border-t border-main flex flex-col sm:flex-row items-center justify-between gap-4">
      <button (click)="changePage(currentPage - 1)"
        class="w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 border border-main bg-surface rounded-xl text-sm font-semibold hover:bg-brand-purple/5 text-main shadow-sm transition-all active:bg-brand-purple/10">
        <i class="fas fa-chevron-left"></i>
        Previous
      </button>
      <div class="text-sm text-muted font-medium order-first sm:order-none">
        Page <span class="text-main font-bold">{{ currentPage }}</span> of
        {{ totalPages }}
      </div>
      <button (click)="changePage(currentPage + 1)"
        class="w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 border border-main bg-surface rounded-xl text-sm font-semibold hover:bg-brand-purple/5 text-main shadow-sm transition-all active:bg-brand-purple/10">
        Next
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<!-- Modal -->
@if (isModalOpen) {
<div class="fixed inset-0 z-[60] overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity" aria-hidden="true"
      (click)="closeModal()"></div>

    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

    <div
      class="inline-block align-bottom bg-surface border border-main rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full animate-in">
      <form (ngSubmit)="onSubmit()">
        <div class="bg-surface px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
              <h3 class="text-xl font-bold text-main" id="modal-title">
                {{ isEditMode ? "Edit User" : "Create New User" }}
              </h3>
              <div class="mt-4 space-y-4">
                <div>
                  <label for="name" class="block text-sm font-semibold text-muted">Name *</label>
                  <input type="text" name="name" id="name" [(ngModel)]="userData.name" required
                    class="mt-1 block w-full border-main rounded-xl shadow-sm focus:ring-brand-purple focus:border-brand-purple sm:text-sm p-3 bg-app text-main placeholder-muted"
                    placeholder="Enter full name" />
                </div>
                <div>
                  <label for="email" class="block text-sm font-semibold text-muted">Email *</label>
                  <input type="email" name="email" id="email" [(ngModel)]="userData.email" required
                    class="mt-1 block w-full border-main rounded-xl shadow-sm focus:ring-brand-purple focus:border-brand-purple sm:text-sm p-3 bg-app text-main placeholder-muted"
                    placeholder="Enter email address" />
                </div>
                @if (!isEditMode) {
                <div>
                  <label for="password" class="block text-sm font-semibold text-muted">Password *</label>
                  <input type="password" name="password" id="password" [(ngModel)]="userData.password" required
                    minlength="8"
                    class="mt-1 block w-full border-main rounded-xl shadow-sm focus:ring-brand-purple focus:border-brand-purple sm:text-sm p-3 bg-app text-main placeholder-muted"
                    placeholder="Enter password (min 8 characters)" />
                </div>
                } @else {
                <div>
                  <label for="password" class="block text-sm font-semibold text-muted">Password (leave blank to keep
                    current)</label>
                  <input type="password" name="password" id="password" [(ngModel)]="userData.password" minlength="8"
                    class="mt-1 block w-full border-main rounded-xl shadow-sm focus:ring-brand-purple focus:border-brand-purple sm:text-sm p-3 bg-app text-main placeholder-muted"
                    placeholder="Enter new password (optional)" />
                </div>
                }
                <div>
                  <label for="role_id" class="block text-sm font-semibold text-muted">Role *</label>
                  <select name="role_id" id="role_id" [(ngModel)]="userData.role_id" required
                    class="mt-1 block w-full border-main rounded-xl shadow-sm focus:ring-brand-purple focus:border-brand-purple sm:text-sm p-3 bg-app text-main">
                    <option value="" disabled>Select Role</option>
                    @for (role of RolesList; track role.id) {
                    <option [value]="role.id">
                      {{ role.name }}
                    </option>
                    }
                  </select>
                </div>
                <div>
                  <label for="council_id" class="block text-sm font-semibold text-muted">Council *</label>
                  <select name="council_id" id="council_id" [(ngModel)]="userData.council_id" required
                    class="mt-1 block w-full border-main rounded-xl shadow-sm focus:ring-brand-purple focus:border-brand-purple sm:text-sm p-3 bg-app text-main">
                    <option value="" disabled>Select Council</option>
                    @for (council of CouncilList; track council.id) {
                    <option [value]="council.id">
                      {{ council.name }}
                    </option>
                    }
                  </select>
                </div>
                <div>
                  <label for="status" class="block text-sm font-semibold text-muted">Status</label>
                  <select name="status" id="status" [(ngModel)]="userData.status" required
                    class="mt-1 block w-full border-main rounded-xl shadow-sm focus:ring-brand-purple focus:border-brand-purple sm:text-sm p-3 bg-app text-main">
                    <option value="Active">Active</option>
                    <option value="Offline">Offline</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-app px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-2 border-t border-main">
          <button type="submit"
            class="w-full inline-flex justify-center rounded-xl border border-transparent shadow-md px-6 py-2.5 bg-brand-purple text-sm font-bold text-white hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-purple sm:ml-3 sm:w-auto transition-all">
            {{ isEditMode ? "Update" : "Create" }}
          </button>
          <button type="button" (click)="closeModal()"
            class="mt-3 w-full inline-flex justify-center rounded-xl border border-main shadow-sm px-6 py-2.5 bg-surface text-sm font-bold text-main hover:bg-brand-purple/5 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-purple sm:mt-0 sm:ml-3 sm:w-auto transition-all">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
}